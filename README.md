# ğŸ“¸ Memento Game Bot

Telegram-Ğ±Ğ¾Ñ‚ Ğ´Ğ»Ñ Ğ³Ñ€ÑƒĞ¿Ğ¿Ğ¾Ğ²Ğ¾Ğ¹ Ñ„Ğ¾Ñ‚Ğ¾-Ğ¸Ğ³Ñ€Ñ‹ Ğ²Ğ¾ Ğ²Ñ€ĞµĞ¼Ñ Ğ²Ğ¸Ğ´ĞµĞ¾Ğ·Ğ²Ğ¾Ğ½ĞºĞ¾Ğ².

Memento Ğ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°ĞµÑ‚ Ğ¾Ğ¶Ğ¸Ğ²Ğ¸Ñ‚ÑŒ Ñ€Ğ°Ğ·Ğ³Ğ¾Ğ²Ğ¾Ñ€: Ğ±Ğ¾Ñ‚ Ğ¿Ñ€Ğ¸ÑÑ‹Ğ»Ğ°ĞµÑ‚ Ğ·Ğ°Ğ´Ğ°Ğ½Ğ¸Ğµ, ÑƒÑ‡Ğ°ÑÑ‚Ğ½Ğ¸ĞºĞ¸ Ğ´ĞµĞ»ÑÑ‚ÑÑ Ñ„Ğ¾Ñ‚Ğ¾ Ğ¸ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸ÑĞ¼Ğ¸, Ğ·Ğ°Ñ‚ĞµĞ¼ Ğ³Ğ¾Ğ»Ğ¾ÑÑƒÑÑ‚ Ğ·Ğ° Ğ»ÑƒÑ‡ÑˆĞ¸Ğ¹ Ğ¾Ñ‚Ğ²ĞµÑ‚.

Production-ready pet project, ÑÑ„Ğ¾ĞºÑƒÑĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ğ½Ğ° Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğµ, Ñ‡Ğ¸ÑÑ‚Ñ‹Ñ… ÑĞ»Ğ¾ÑÑ… Ğ¸ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğ¸ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸ÑĞ¼Ğ¸.
---

## Ğ¢ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ ÑÑ‚ĞµĞº
- **Go 1.24+**  
- **Telebot** (Ğ Ğ°Ğ±Ğ¾Ñ‚Ğ° Ñ Telegram Bot API)  
- **PostgreSQL + goose** (Ğ¥Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ÑÑ‡ĞµÑĞºĞ¸Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…)  
- **FSM (Finite State Machine)** (Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¸Ğ³Ñ€Ğ¾Ğ²Ñ‹Ğ¼Ğ¸ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸ÑĞ¼Ğ¸)
- **Docker**, **Makefile** (ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¸ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ ÑĞ±Ğ¾Ñ€ĞºĞ¸)
- **slog/log**
- **Unit & integration tests** 

## ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ñ‚ĞµÑ…Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ¾ÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸
- FSM Ğ´Ğ»Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ¸Ğ³Ñ€Ğ¾Ğ²Ñ‹Ğ¼Ğ¸ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸ÑĞ¼Ğ¸ (round â†’ vote â†’ score)
- Ğ Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ğ¸Ğµ ÑĞ»Ğ¾Ñ‘Ğ²: handlers / services / repositories
- Ğ ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¸ Ğ´Ğ»Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ñ Ğ‘Ğ”
- Goose Ğ´Ğ»Ñ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¹
- Actor-per-chat Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ (ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ñ‡Ğ°Ñ‚ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ğ¼ Ğ°ĞºÑ‚Ğ¾Ñ€Ğ¾Ğ¼)
- Unit-Ñ‚ĞµÑÑ‚Ñ‹ Ğ´Ğ»Ñ Ğ¸Ğ³Ñ€Ğ¾Ğ²Ğ¾Ğ¹ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ¸
- ĞšĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ğ·Ğ°Ğ¿ÑƒÑĞº Ñ‡ĞµÑ€ĞµĞ· Docker Compose

## Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ
### ĞšĞ»Ğ¾Ğ½Ğ¸Ñ€ÑƒĞ¹Ñ‚Ğµ Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¹
```bash
git clone https://github.com/kiselevos/memento_game_bot.git
cd memento_game_bot
```
### Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚Ğµ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸
```bash
go mod tidy
go mod download

# Ğ¸Ğ»Ğ¸ Ğ¾Ğ´Ğ½Ğ¾Ğ¹ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ¾Ğ¹ make
make tidy
```

### Ğ—Ğ°Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ
```bash
# ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ .env
APP_ENV=local # local/prod

DB_USER=memento_user
DB_PASSWORD=memento_password
DB_NAME=memento_bot
DB_PORT=5432

ADMINS_ID=your_tg_id
TG_TOKEN=your_telegram_bot_token
```
> Ğ’ APP_ENV=local - Ğ±Ğ¾Ñ‚ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡Ğ°ĞµÑ‚ÑÑ Ğº localhost:5432, Ğ° Ğ¿Ñ€Ğ¸ APP_ENV=docker - Ğº ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ñƒ postgres.

### ĞŸĞ¾Ğ´Ğ½Ğ¸Ğ¼Ğ¸Ñ‚Ğµ Ğ±Ğ°Ğ·Ñƒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¸ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚Ğµ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸
```bash
docker compose -f docker-compose.db.yml up -d

# Ğ¸Ğ»Ğ¸ Ğ¾Ğ´Ğ½Ğ¾Ğ¹ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ¾Ğ¹ make 
make db-up
```

### Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚Ğµ Ğ±Ğ¾Ñ‚Ğ° 
#### Ğ›Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾
```bash
go run ./cmd/main.go

# Ğ¸Ğ»Ğ¸ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ¾Ğ¹ make 
make run
```
#### Docker
```bash
docker compose -f docker-compose.yml up -d

# Ğ¸Ğ»Ğ¸ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ¾Ğ¹ make 
make bot-up
```

## ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹

- `/start` - Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ  
- `/startgame` - Ğ½Ğ°Ñ‡Ğ°Ñ‚ÑŒ Ğ½Ğ¾Ğ²ÑƒÑ Ğ¸Ğ³Ñ€Ñƒ (ÑĞ±Ñ€Ğ¾Ñ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ¹)  
- `/endgame` - Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞ¸Ñ‚ÑŒ Ğ¸Ğ³Ñ€Ñƒ Ğ¸ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ñ„Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑÑ‡Ñ‘Ñ‚  
- `/newround` - Ğ½Ğ°Ñ‡Ğ°Ñ‚ÑŒ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ñ€Ğ°ÑƒĞ½Ğ´  
- `/vote` - Ğ½Ğ°Ñ‡Ğ°Ñ‚ÑŒ Ğ³Ğ¾Ğ»Ğ¾ÑĞ¾Ğ²Ğ°Ğ½Ğ¸Ğµ  
- `/finishvote` - Ğ´Ğ¾ÑÑ€Ğ¾Ñ‡Ğ½Ğ¾ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞ¸Ñ‚ÑŒ Ğ³Ğ¾Ğ»Ğ¾ÑĞ¾Ğ²Ğ°Ğ½Ğ¸Ğµ  
- `/score` - Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğµ Ğ¾Ñ‡ĞºĞ¸ Ğ¸Ğ³Ñ€Ğ¾ĞºĞ¾Ğ²
- `/feedback` - Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ½Ğ°Ñ ÑĞ²ÑĞ·ÑŒ
---

### ĞŸÑ€Ğ¾ĞµĞºÑ‚Ğ½Ğ°Ñ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°
```bash
memento_game_bot/
â”‚
â”œâ”€â”€ ABOUT.md
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ Makefile
â”œâ”€â”€ PRIVACY.md
â”œâ”€â”€ README.md
â”œâ”€â”€ assets
â”‚Â Â  â”œâ”€â”€ messages.go
â”‚Â Â  â””â”€â”€ tasks.json
â”œâ”€â”€ cmd
â”‚Â Â  â””â”€â”€ main.go
â”œâ”€â”€ docker-compose.db.yml
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ go.mod
â”œâ”€â”€ go.sum
â”œâ”€â”€ internal
â”‚Â Â  â”œâ”€â”€ bot
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ middleware
â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ check_admin.go
â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ check_bot_rights.go
â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ command__filter.go
â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ pulling.go
â”‚Â Â  â”‚Â Â  â””â”€â”€ utils.go
â”‚Â Â  â”œâ”€â”€ botinterface
â”‚Â Â  â”‚Â Â  â””â”€â”€ botiface.go
â”‚Â Â  â”œâ”€â”€ config
â”‚Â Â  â”‚Â Â  â””â”€â”€ config.go
â”‚Â Â  â”œâ”€â”€ db
â”‚Â Â  â”‚Â Â  â””â”€â”€ db.go
â”‚Â Â  â”œâ”€â”€ feedback
â”‚Â Â  â”‚Â Â  â””â”€â”€ manager.go
â”‚Â Â  â”œâ”€â”€ game
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ chat_actor.go
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ fsm.go
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ fsm_test.go
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ integration_test.go
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ manager.go
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ manager_test.go
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ session.go
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ session_test.go
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ stats_recorder.go
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ task_store.go
â”‚Â Â  â”‚Â Â  â””â”€â”€ user.go
â”‚Â Â  â”œâ”€â”€ handlers
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ feedback.go
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ game.go
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ init.go
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ photo.go
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ round.go
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ score.go
â”‚Â Â  â”‚Â Â  â””â”€â”€ vote.go
â”‚Â Â  â”œâ”€â”€ logging
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ logger.go
â”‚Â Â  â”‚Â Â  â””â”€â”€ notify.go
â”‚Â Â  â”œâ”€â”€ models
â”‚Â Â  â”‚Â Â  â””â”€â”€ task.go
â”‚Â Â  â”œâ”€â”€ repositories
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ feedback_repo.go
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ helpers.go
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ main_test.go
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ recorder_sessions_test.go
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ recorder_stats_test.go
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ recorder_tasks_test.go
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ session.go
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ stats_recorder.go
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ task.go
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ task_store.go
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ user.go
â”‚Â Â  â”‚Â Â  â””â”€â”€ user_repo_test.go
â”‚Â Â  â””â”€â”€ tasks
â”‚Â Â      â””â”€â”€ loader.go
â”œâ”€â”€ migrations
â”‚Â Â  â””â”€â”€ 00001_init.sql
â””â”€â”€ repositories.test
```

### ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Make
```bash
make tidy    # Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹ Go
make db-up   # ĞŸĞ¾Ğ´Ğ½ÑÑ‚ÑŒ PostgreSQL Ğ¸ Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸
make run     # Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ğ±Ğ¾Ñ‚Ğ° Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾
make db-stop # ĞÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ğ¾Ğ²
```

## ğŸ“¬ ĞĞ±Ñ€Ğ°Ñ‚Ğ½Ğ°Ñ ÑĞ²ÑĞ·ÑŒ

Ğ¥Ğ¾Ñ‚Ğ¸Ñ‚Ğµ Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶Ğ¸Ñ‚ÑŒ Ğ·Ğ°Ğ´Ğ°Ğ½Ğ¸Ğµ, ÑĞ¾Ğ¾Ğ±Ñ‰Ğ¸Ñ‚ÑŒ Ğ¾Ğ± Ğ¾ÑˆĞ¸Ğ±ĞºĞµ Ğ¸Ğ»Ğ¸ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ ÑĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ÑĞ¿Ğ°ÑĞ¸Ğ±Ğ¾?  
Ğ¡Ğ²ÑĞ·ÑŒ: [@kiselevos](https://t.me/kiselevos)
