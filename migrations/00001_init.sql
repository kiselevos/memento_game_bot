-- +goose Up

SET TIME ZONE 'UTC';

-- =========================
-- tasks
-- =========================
CREATE TABLE IF NOT EXISTS tasks (
  id          BIGSERIAL PRIMARY KEY,
  text        TEXT NOT NULL UNIQUE,
  is_active   BOOLEAN NOT NULL DEFAULT TRUE,
  use_count   BIGINT  NOT NULL DEFAULT 0,
  skip_count  BIGINT  NOT NULL DEFAULT 0,
  photo_count BIGINT  NOT NULL DEFAULT 0,
  created_at  TIMESTAMPTZ NOT NULL DEFAULT now(),
  updated_at  TIMESTAMPTZ NOT NULL DEFAULT now()
);

CREATE INDEX IF NOT EXISTS idx_tasks_is_active ON tasks(is_active);

INSERT INTO tasks (text)
VALUES
('üì∏ –§–æ—Ç–æ –µ–¥—ã, –∫–æ—Ç–æ—Ä–æ–µ –ø–µ—Ä–≤–æ–µ –ø–æ–ø–∞–¥—ë—Ç—Å—è –≤ —Ç–≤–æ–µ–π –≥–∞–ª–µ—Ä–µ–µ.'),
('üßç –§–æ—Ç–æ, —Å–¥–µ–ª–∞–Ω–Ω–æ–µ –≤ –æ–¥–∏–Ω–æ—á–µ—Å—Ç–≤–µ –¥–ª—è —Å–µ–±—è. –ü–æ—á–µ–º—É —Ç—ã –µ–≥–æ —Å–¥–µ–ª–∞–ª?'),
('üèÜ –§–æ—Ç–æ, –∫–æ—Ç–æ—Ä—ã–º —Ç—ã –≥–æ—Ä–¥–∏—à—å—Å—è. (–î–∞ —è –ø—Ä–æ—Å—Ç–æ –°—Ç—ç–Ω–ª–∏ –ö—É–±—Ä–∏–∫!)'),
('üêæ –§–æ—Ç–æ –∂–∏–≤–æ—Ç–Ω–æ–≥–æ, –∫–æ—Ç–æ—Ä–æ–µ –Ω–µ —Ç–≤–æ—ë.'),
('‚ùì –§–æ—Ç–æ, –∫–æ—Ç–æ—Ä–æ–µ –æ—á–µ–Ω—å —Å–ª–æ–∂–Ω–æ –æ–±—ä—è—Å–Ω–∏—Ç—å. (–ß—Ç–æ —Ç—É—Ç –≤–æ–æ–±—â–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç?)'),
('üò¨ –§–æ—Ç–æ, –∫–æ—Ç–æ—Ä–æ–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—É–¥–æ–±–Ω–æ —Å–ª—É—á–∞–π–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å –∫–æ–ª–ª–µ–≥–∞–º.'),
('ü§¶ –§–æ—Ç–æ, –≥–¥–µ —Ç—ã –≤—ã–≥–ª—è–¥–∏—à—å —Å–æ–≤—Å–µ–º –Ω–µ —Ç–∞–∫, –∫–∞–∫ —Ö–æ—Ç–µ–ª.'),
('üï∫ –§–æ—Ç–æ —Å–æ —Å—Ç—Ä–∞–Ω–Ω–æ–π –ø–æ–∑–æ–π.'),
('üìñ –§–æ—Ç–æ —Å –∏—Å—Ç–æ—Ä–∏–µ–π. –†–∞—Å—Å–∫–∞–∂–∏, —á—Ç–æ –∑–∞ –∫–∞–¥—Ä–æ–º.'),
('üíÉ –§–æ—Ç–æ, –≥–¥–µ —Ç—ã —Å–µ–±–µ –Ω—Ä–∞–≤–∏—à—å—Å—è. –ü—Ä–æ—Å—Ç–æ –≤–∞—É!'),
('üê∏ –§–æ—Ç–æ, –∫–æ—Ç–æ—Ä–æ–µ –º–æ–≥–ª–æ –±—ã —Å—Ç–∞—Ç—å –º–µ–º–æ–º.'),
('üò≤ –§–æ—Ç–æ, –∫–æ–≥–¥–∞ —Ç—ã –Ω–µ –±—ã–ª –≥–æ—Ç–æ–≤. (–ó–∞—Å—Ç–∞–ª–∏ –≤—Ä–∞—Å–ø–ª–æ—Ö.)'),
('ü§≥ –ù–µ—É–¥–∞—á–Ω–æ–µ —Å–µ–ª—Ñ–∏.'),
('üßí –§–æ—Ç–æ, –≥–¥–µ —Ç—ã –º–æ–ª–æ–¥–æ–π –∏ —Å–∏—è—é—â–∏–π, –∫–∞–∫ —Å–≤–µ–∂–∏–π –æ–≥—É—Ä—á–∏–∫.'),
('üë®‚Äçüî¨ –§–æ—Ç–æ, –≥–¥–µ —Ç—ã –≤—ã–≥–ª—è–¥–∏—à—å –∫–∞–∫ –∞–±—Å–æ–ª—é—Ç–Ω—ã–π —ç–∫—Å–ø–µ—Ä—Ç. (–ù–µ–≤–∞–∂–Ω–æ –≤ –∫–∞–∫–æ–π –æ–±–ª–∞—Å—Ç–∏)'),
('üå¥ –§–æ—Ç–æ, –≥–¥–µ —Ç—ã –∫–∞–π—Ñ—É–µ—à—å –æ—Ç –∂–∏–∑–Ω–∏. –ü–æ–ª–Ω—ã–π —Ä–µ–ª–∞–∫—Å.'),
('üèô –§–æ—Ç–æ, –∫–æ—Ç–æ—Ä–æ–µ –º–æ–≥ –±—ã —Å–¥–µ–ª–∞—Ç—å –ª—é–±–æ–π —Ç—É—Ä–∏—Å—Ç –≤ —Ç–≤–æ—ë–º –≥–æ—Ä–æ–¥–µ.'),
('üë™ –§–æ—Ç–æ(–æ—Ç–∫—Ä—ã—Ç–∫–∞), –∫–æ—Ç–æ—Ä–æ–µ —Ç–µ–±–µ –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ —Ä–æ–¥—Å—Ç–≤–µ–Ω–Ω–∏–∫–∏.'),
('üõç –§–æ—Ç–æ –≤ –Ω–æ–≤–æ–π –≤–µ—â–∏, –∫–æ—Ç–æ—Ä—É—é —Ç—ã —Å–µ–±–µ –∫—É–ø–∏–ª.'),
('üé¨ –§–æ—Ç–æ, –≥–¥–µ —Ç—ã –≤—ã–≥–ª—è–¥–∏—à—å –∫–∞–∫ –≥–µ—Ä–æ–π —Ñ–∏–ª—å–º–∞. (–ö–æ–º–µ–¥–∏—è? –¢—Ä–∏–ª–ª–µ—Ä?)'),
('üß† –§–æ—Ç–æ, –∫–æ—Ç–æ—Ä–æ–µ –∏–¥–µ–∞–ª—å–Ω–æ –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Ç–≤–æ–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä.'),
('üï∞ –§–æ—Ç–æ, –∫–æ—Ç–æ—Ä–æ–µ –≤—ã–∑—ã–≤–∞–µ—Ç –Ω–æ—Å—Ç–∞–ª—å–≥–∏—é.'),
('üíå –§–æ—Ç–æ, –∫–æ—Ç–æ—Ä–æ–µ –º–æ–∂–Ω–æ –±—ã–ª–æ –±—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–∞–∫ –æ—Ç–∫—Ä—ã—Ç–∫—É.'),
('üß≠ –§–æ—Ç–æ –∏–∑ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ–≥–æ –º–µ—Å—Ç–∞. –ö–∞–∫ —Ç—ã —Ç—É–¥–∞ –ø–æ–ø–∞–ª?'),
('üì¢ –§–æ—Ç–æ, –∫–æ—Ç–æ—Ä–æ–µ –≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ —Ä–µ–∫–ª–∞–º–∞. –ü—Ä–æ–¥–∞–π —ç—Ç–æ—Ç –º–æ–º–µ–Ω—Ç!'),
('üìÜ –§–æ—Ç–æ, –∫–æ—Ç–æ—Ä–æ–µ –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Ç–≤–æ–π —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–π –¥–µ–Ω—å.'),
('üíø –§–æ—Ç–æ, –∫–æ—Ç–æ—Ä–æ–µ –º–æ–≥–ª–æ –±—ã —Å—Ç–∞—Ç—å –æ–±–ª–æ–∂–∫–æ–π —Ç–≤–æ–µ–≥–æ –∞–ª—å–±–æ–º–∞. (–ö–∞–∫–æ–π –∂–∞–Ω—Ä?)'),
('üìö –§–æ—Ç–æ, –∫–æ—Ç–æ—Ä–æ–µ –ø–æ–¥–æ—à–ª–æ –±—ã –¥–ª—è —É—á–µ–±–Ω–∏–∫–∞. (–ü–æ –∫–∞–∫–æ–º—É –ø—Ä–µ–¥–º–µ—Ç—É?)'),
('üß§ –§–æ—Ç–æ, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º –∫—Ç–æ-—Ç–æ —Ç–µ–±—è –æ–±–Ω–∏–º–∞–µ—Ç.'),
('üìé –§–æ—Ç–æ, –∫–æ—Ç–æ—Ä–æ–µ —Ç—ã —Ö—Ä–∞–Ω–∏—à—å "–Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π".'),
('üì¶ –§–æ—Ç–æ, –∫–æ—Ç–æ—Ä–æ–µ —Ç—ã —Ö–æ—Ç–µ–ª —É–¥–∞–ª–∏—Ç—å, –Ω–æ –∑–∞–±—ã–ª.'),
('ü´£ –§–æ—Ç–æ, –∫–æ—Ç–æ—Ä–æ–µ —Ç—ã –±—ã –Ω–µ –ø–æ–∫–∞–∑–∞–ª —Ä–æ–¥–∏—Ç–µ–ª—è–º.'),
('[–ë–õ–ò–¶] üñ• –°–∫—Ä–∏–Ω—à–æ—Ç —ç–∫—Ä–∞–Ω–∞ —Ç–≤–æ–µ–≥–æ —Ç–µ–ª–µ—Ñ–æ–Ω–∞'),
('[–ë–õ–ò–¶] üö∞ –§–æ—Ç–æ —Ç–≤–æ–µ–π –∫—É—Ö–æ–Ω–Ω–æ–π —Ä–∞–∫–æ–≤–∏–Ω—ã –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å.'),
('[–ë–õ–ò–¶] üßä –§–æ—Ç–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–∞.'),
('[–ë–õ–ò–¶] ‚è± –§–æ—Ç–æ, –¥–µ—Å—è—Ç–æ–µ –ø–æ —Å—á–µ—Ç—É, –≤ —Ç–≤–æ–µ–π –≥–∞–ª–µ—Ä–µ–µ'),
('[–ë–õ–ò–¶] üì∫ –°–∫—Ä–∏–Ω—à–æ—Ç —Ç–≤–æ–µ–≥–æ –ø–µ—Ä–≤–æ–≥–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω–æ–≥–æ –≤–∏–¥–µ–æ –Ω–∞ YouTube'),
('[–ë–õ–ò–¶] üçø –ü–æ—Å—Ç–µ—Ä —Ñ–∏–ª—å–º–∞, –∫–æ—Ç–æ—Ä—ã–π —á–µ—Ä—Ç–æ–≤—Å–∫–∏ –ø—É–≥–∞–ª —Ç–µ–±—è –≤ –¥–µ—Ç—Å—Ç–≤–µ'),
('[–ë–õ–ò–¶] üé¨ –ü–æ—Å—Ç–µ—Ä –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ñ–∏–ª—å–º–∞ –∏–ª–∏ —Å–µ—Ä–∏–∞–ª–∞, –∫–æ—Ç–æ—Ä—ã–π —Ç—ã —Å–º–æ—Ç—Ä–µ–ª.'),
('[–ë–õ–ò–¶] üßí –§–æ—Ç–æ —Å–µ–ª–µ–±—Ä–∏—Ç–∏, –∫–æ—Ç–æ—Ä—ã–π –±—ã–ª –∫—Ä–∞—à–µ–º —Ç–≤–æ–µ–≥–æ –¥–µ—Ç—Å—Ç–≤–∞.'),
('[–ë–õ–ò–¶] üîé –°–∫—Ä–∏–Ω—à–æ—Ç —Ç–≤–æ–∏—Ö –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ google.'),
('[–ë–õ–ò–¶] üëë –§–æ—Ç–æ —Å–µ–ª–µ–±—Ä–∏—Ç–∏, —Å –∫–æ—Ç–æ—Ä—ã–º —Ç—ã –±—ã –Ω–µ –æ—Ç–∫–∞–∑–∞–ª—Å—è –æ—Ç –æ—á–µ–Ω—å –ª–∏—á–Ω–æ–≥–æ —Å–≤–∏–¥–∞–Ω–∏—è.'),
('[–ë–õ–ò–¶] üòÇ –°–∫—Ä–∏–Ω—à–æ—Ç —Ç–≤–æ–µ–≥–æ –ª—é–±–∏–º–æ–≥–æ –º–µ–º–∞.')
ON CONFLICT (text) DO NOTHING;

-- =========================
-- users
-- =========================
CREATE TABLE IF NOT EXISTS users (
  id         BIGSERIAL PRIMARY KEY,
  tg_user_id BIGINT NOT NULL UNIQUE,

  username   TEXT,
  first_name TEXT,

  games_played BIGINT NOT NULL DEFAULT 0,
  photos_sent  BIGINT NOT NULL DEFAULT 0,
  votes_cast   BIGINT NOT NULL DEFAULT 0,

  created_at TIMESTAMPTZ NOT NULL DEFAULT now(),
  updated_at TIMESTAMPTZ NOT NULL DEFAULT now()
);

-- =========================
-- sessions
-- =========================
CREATE TABLE IF NOT EXISTS sessions (
  id         BIGSERIAL PRIMARY KEY,
  chat_id    BIGINT NOT NULL,
  players    INTEGER NOT NULL DEFAULT 0,
  started_at TIMESTAMPTZ NOT NULL DEFAULT now(),
  ended_at   TIMESTAMPTZ
);

CREATE INDEX IF NOT EXISTS idx_sessions_chat_id ON sessions(chat_id);

-- =========================
-- feedback (always from DM)
-- =========================
CREATE TABLE IF NOT EXISTS feedback (
  id         BIGSERIAL PRIMARY KEY,
  tg_user_id BIGINT NOT NULL,
  username   TEXT,
  first_name TEXT,
  message    TEXT NOT NULL,
  created_at TIMESTAMPTZ NOT NULL DEFAULT now()
);

CREATE INDEX IF NOT EXISTS idx_feedback_created_at ON feedback(created_at DESC);

-- +goose Down

DROP TABLE IF EXISTS feedback CASCADE;
DROP TABLE IF EXISTS sessions CASCADE;
DROP TABLE IF EXISTS users CASCADE;
DROP TABLE IF EXISTS tasks CASCADE;